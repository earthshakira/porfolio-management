<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: routes/trades.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: routes/trades.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module TradeEndpoints
 */
const express = require('express');
const backend = require('../dal/backend');
const models = require('../dal/models');

/**
 * The trade router which handles the requests for creating, updating and listing trades
 */
const router = express.Router();


let validateTradeType = (payload) => {
    if (payload.tradeType != "BUY" &amp;&amp; payload.tradeType != "SELL") {
        return [`Incorrect 'tradeType' can only be BUY or SELL got '${payload.tradeType}'`]
    } 
    return []
}

let validateQuantity = (payload) => {
    if (!(payload.quantity > 0 &amp;&amp; parseInt(payload.quantity) == payload.quantity))
        return [`'quantity' must be a positive integer got '${payload.quantity}'`]
    return []
}

let validatePrice = (payload) => {
    if (!(payload.price > 0 &amp;&amp; parseInt(payload.price*100) == payload.price * 100))
        return [`'price' must be a positive float with atmost 2 decimals got '${payload.price}'`]
    return []
}


/**
 * We validate the payload to ensure input it check the conditions
 *  1. Required Fields are present
 *  2. All values are non negative and in proper precision
 * 
 * @param  {object} payload - input from the client in `req.body`
 */
let validateTradePayload = (payload) => {
    let requiredFields = ["tradeType","quantity","price","tickerSymbol"]
    let errors = []
    for(let field of requiredFields)
        if (!(field in payload))
            errors.push(`'${field}' required but not found`)

    errors.push(...validateTradeType(payload))
    errors.push(...validateQuantity(payload))
    errors.push(...validatePrice(payload))
    
    return errors
}

router.get('/', function(req, res) {
  console.log("req",req.body)
  res.json(req.body)
});


router.post('/', async function(req, res) {
    let payload = req.body
    let type = 'B'
    let errors = validateTradePayload(payload)
    if (errors.length) {
        res.status(400)
        res.json(errors)
        return
    }
    try {
        let {tradeType,tickerSymbol,price,quantity} = payload;
        let trade = new models.Trade(req.auth.user,tradeType == 'BUY' ? 'B' : 'S',tickerSymbol,price,quantity)
        let resp = await trade.order()
        res.json(resp)
    } catch(error) {
        res.status(400);
        res.json([error.toString()])
    }
    
});

router.put('/:tradeId/', function(req, res, next) {
    console.log("req",req.body)
    res.json(req.body);
});

router.delete('/:tradeId/', function(req, res, next) {
    console.log("req",req.body)
    res.json(req.body);
});

module.exports = router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Backend.html">Backend</a></li><li><a href="module-Enums.html">Enums</a></li><li><a href="module-LuaScripts.html">LuaScripts</a></li><li><a href="module-Models.html">Models</a></li><li><a href="module-Redis%2520Backend.html">Redis Backend</a></li><li><a href="module-TradeEndpoints.html">TradeEndpoints</a></li></ul><h3>Classes</h3><ul><li><a href="module-Models.Trade.html">Trade</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Oct 01 2021 01:12:00 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
